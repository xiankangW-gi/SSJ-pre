3 异质性代理人问题的雅可比矩阵计算

**引言解析**

首先，作者开宗明义地指出本章的目标：计算雅可比矩阵，具体来说是总量（例如总资本$K$）对总价（例如利率$r$或工资$w$）的偏导数，即$\partial K / \partial r$和$\partial K / \partial w$。在宏观经济模型中，这些导数构成的雅可比矩阵描述了经济系统对冲击的“脉冲响应”（Impulse Response）。了解这个矩阵对于求解模型的动态路径至关重要，特别是在像克鲁塞尔-史密斯（Krusell-Smith）模型这样的异质性代理人模型中。

本节将这个思想推广，不仅仅局限于$K, r, w$，而是推广到一个普适的框架：一个描述任意“总量输入”和任意“总量输出”之间映射关系的函数$\kappa$。

*   **输入（Inputs）**: 通常是影响个体决策的总体价格或变量，比如利率、工资率、税率等。
*   **输出（Outputs）**: 通常是个体决策在总体层面的加总，比如总储蓄、总消费、总投资等。

本章的核心贡献是提出了一个名为**“假新闻算法”（fake news algorithm）**的快速计算方法，用来计算任意输出对任意输入的雅可比矩阵。

---

### 3.1 一般模型表示

**框架搭建**

为了提出一个通用算法，作者首先建立了一个抽象但普适的框架来描述一大类异质性代理人模型。这个框架将模型的动态过程归结为三个核心方程。

*   **基本设定**:
    *   $n_x$个输入变量（例如，$r$和$w$就是两个输入，$n_x=2$）。
    *   $n_y$个输出变量（例如，$K$和$C$就是两个输出，$n_y=2$）。
    *   状态空间被离散化为$n_g$个网格点。
    *   $D_t$是一个$n_g \times 1$的向量，代表$t$时刻，代理人在$n_g$个网格点上的分布情况。$D_t$的每个元素表示在该网格点上的代理人（或财富）占比，所有元素之和为1。
    *   $Y_t$是$n_y \times 1$的向量，代表$t$时刻的总量输出。它通过对个体“结果”（outcomes）按分布进行加权平均得到，即$Y_t = y_t' D_t$。这里的$y_t$是一个$n_g \times n_y$的矩阵，每一行代表一个网格点，每一列代表一个输出变量。例如，如果输出是资本和消费，那么$y_t$的第一列就是每个网格点上的个体资本持有量，第二列就是个体消费量。

**核心方程组**

作者假设模型的动态可以由以下三个方程刻画：

$$v_t = v(v_{t+1}, X_t) \quad (10)$$

*   **解析**: 这是模型的**价值函数方程**或类似的倒向迭代方程。
    *   $v_t$是一个$n_g \times 1$的向量，通常代表在每个网格点上的价值函数值，或者是价值函数的一阶导数（边际价值）。
    *   $X_t$是$t$时刻的$n_x \times 1$的输入向量（例如，$X_t = [r_t, w_t]'$）。
    *   这个方程是**倒向的（backward-looking）**。为了知道今天的价值$v_t$，你需要知道明天的价值$v_{t+1}$和今天的总量输入$X_t$。这是动态规划问题的典型特征。

$$D_{t+1} = \Lambda(v_{t+1}, X_t)' D_t \quad (11)$$

*   **解析**: 这是模型的**分布更新方程**或运动定律。
    *   $\Lambda(\cdot)$是一个$n_g \times n_g$的**转移矩阵（transition matrix）**。它的元素$\Lambda_{ij}$表示从状态$j$转移到状态$i$的概率或比例。
    *   请注意这里的转置符号。在标准记法中，$D_{t+1} = \Lambda D_t$，其中$\Lambda_{ij}$是从$j$到$i$的转移概率。但这里写成$\Lambda'$，意味着$\Lambda_{ij}$是从$i$到$j$的转移概率。这只是一个记法选择，不影响本质。
    *   这个转移矩阵本身是内生的，它依赖于代理人的最优决策，而最优决策又依赖于价值函数$v_{t+1}$和总量输入$X_t$。
    *   这个方程是**正向的（forward-looking）**。它描述了分布如何从今天$D_t$演变到明天$D_{t+1}$。

$$Y_t = y(v_{t+1}, X_t)' D_t \quad (12)$$

*   **解析**: 这是模型的**总量输出定义方程**。
    *   $y(\cdot)$是一个$n_g \times n_y$的矩阵，代表个体层面的结果（或称策略函数，policy function）。例如，每个网格点上的最优储蓄量和消费量。
    *   同样，个体决策$y_t$依赖于未来的价值$v_{t+1}$和当前的总量输入$X_t$。
    *   $Y_t$通过对个体结果$y_t$按分布$D_t$进行加权求和（矩阵乘法$y_t' D_t$）得到。

**稳态与映射关系**

*   **稳态（Steady State）**: 当输入永远保持在$X_{ss}$时，系统会收敛到一个固定的点$(Y_{ss}, v_{ss}, D_{ss})$，使得$v_{ss}=v(v_{ss}, X_{ss})$, $D_{ss}=\Lambda(v_{ss}, X_{ss})'D_{ss}$, $Y_{ss}=y(v_{ss}, X_{ss})'D_{ss}$。
*   **转型过程（Transition）**: 我们研究的是一个长度为$T$的时期，它最终会回到这个稳态。所以假设$X_{T-1} = X_{ss}$，并且最终的价值函数$v_T = v_{ss}$。
*   **初始分布**: 假设经济开始于稳态分布，即$D_0 = D_{ss}$。这个假设至关重要，它意味着我们研究的是系统在稳态附近对暂时性冲击的反应。

这三个方程定义了一个从输入序列$X = (X_0, X_1, ..., X_{T-1})$到输出序列$Y = (Y_0, Y_1, ..., Y_{T-1})$的复杂映射：

$$Y = h(X) \quad (13)$$

我们的终极目标就是计算这个映射$h$在稳态点$X_{ss}$处的**雅可比矩阵$J$**。$J$是一个$T \times T$（在单输入单输出情况下）的矩阵，其元素$J_{t,s}$表示在$s$时刻对输入$X_s$施加一个微小的冲击，会对$t$时刻的输出$Y_t$产生多大的影响。

**克鲁塞尔-史密斯模型作为示例**

作者用这个具体模型来展示上述抽象框架是如何应用的。

*   **输入**: $X_t = (r_t, w_t)$
*   **输出**: $Y_t = (K_t, C_t)$
*   **状态**: 个体状态是$(e, k_-)$，即就业状态和期初资产。
*   **价值函数迭代法**:
    *   $v_t$就是价值函数$V_t$在每个状态网格点上的值。
    *   $D_t$就是代理人在状态网格上的分布。
    *   给定$v_{t+1}$和$X_t$，解贝尔曼方程（方程(2)）可以得到$v_t$（这就是方程(10)）和最优资本决策$k_t$。
    *   从个体决策$k_t$和外生的$e$过程，可以构建出状态间的转移矩阵$\Lambda_t'$（这就是方程(11)）。
    *   总量$K_t$和$C_t$通过加总个体决策$k_t$和$c_t$得到，这对应于方程(12)，其中$y_t$就是个体决策$(k_t, c_t)$组成的矩阵。
*   **欧拉方程法**:
    *   这是一种更常用、更高效的方法。这里，$v_t$不再是价值函数本身，而是它的导数$\frac{\partial V_t}{\partial k_-}$（即边际价值）。
    *   通过欧拉方程和包络定理，可以建立起$v_t$和$v_{t+1}$之间的关系，这同样对应方程(10)。
    *   后续步骤与价值函数法类似，从个体决策得到转移矩阵$\Lambda_t$和总量$K_t, C_t$，分别对应方程(11)和(12)。

这个例子说明了该三方程框架的普适性。

---

### 3.2 假新闻算法

这一节是论文的核心，提出了计算雅可比矩阵$J$的快速算法。

**符号约定**

为简化论述，先假设只有一个输入和一个输出（$n_x=1, n_y=1$）。

*   $e^s$: 一个$T \times 1$的向量，只有第$s$个元素是1，其余都是0。
*   $X^s \equiv X_{ss} + e^s dx$: 一个输入序列，只在$s$时刻有一个大小为$dx$的微小冲击，其他时刻都处于稳态。我们称之为“时刻$s$的冲击”。
*   $v_t^s, D_t^s, Y_t^s, \Lambda_t^s, y_t^s$: 相应地，这些是在输入为$X^s$时的模型解。
*   $dY_t^s \equiv Y_t^s - Y_{ss}$: 用$d$表示变量与其稳态值的**差值**。例如，$dy_t^s \equiv y_t^s - y_{ss}$, $d\Lambda_t^s \equiv \Lambda_t^s - \Lambda_{ss}$, $dD_t^s \equiv D_t^s - D_{ss}$。
*   **雅可比矩阵的列**: $J$的第$s$列就是$\lim_{dx \to 0} \frac{dY^s}{dx}$。其中$dY^s$是一个向量，其第$t$个元素是$dY_t^s$。因此，$J$的$(t,s)$元素就是$\lim_{dx \to 0} \frac{dY_t^s}{dx}$。

**直接方法（作为基准）**

这是一种“暴力”计算方法，思路直接但非常耗时。

1.  **对每个冲击时刻$s=0, 1, ..., T-1$**:
    a. **向后迭代**: 施加冲击$X^s = X_{ss} + e^s dx$。从$v_T=v_{ss}$开始，利用方程(10)从$t=T-1$倒推到$t=0$，计算出沿途所有的$v_t^s, \Lambda_t^s, y_t^s$。
    b. **向前迭代**: 从$D_0=D_{ss}$开始，利用方程(11)和上一步计算出的$\Lambda_t^s$，从$t=1$正推到$t=T-1$，计算出沿途所有的分布$D_t^s$。
    c. **计算输出**: 利用方程(12)，计算每个时刻的总量输出$Y_t^s = (y_t^s)' D_t^s$。
    d. **计算导数**: $J$的第$s$列的第$t$个元素就是$J_{t,s} = (Y_t^s - Y_{ss}) / dx$。
2.  重复上述过程$T$次，就能得到完整的$J$矩阵。

这个方法的计算成本极高，因为需要进行$T$次完整的向后和向前迭代。如果$T=300$，计算量就非常大。

**雅可比矩阵$J$的结构**

“假新闻算法”的核心思想是利用了$J$矩阵内部隐藏的结构和规律，避免了大量的重复计算。

首先写出两个核心方程的差分形式：
$$Y_t^s = (y_t^s)' D_t^s \quad (14)$$
$$D_{t+1}^s = (\Lambda_t^s)' D_t^s \quad (15)$$

**引理1**

$$
y_t^s = \begin{cases} 
y_{ss} & s < t \\
y_{T-1-(s-t)}^{T-1} & s \geq t 
\end{cases}
$$
且
$$
\Lambda_t^s = \begin{cases} 
\Lambda_{ss} & s < t \\
\Lambda_{T-1-(s-t)}^{T-1} & s \geq t 
\end{cases}
$$

*   **证明思路与直觉**: 这个引理是动态规划时间不变性的直接体现。
    *   当$s < t$时，冲击在$t$时刻已经发生过了。在$t$时刻做决策时，输入$X_t, X_{t+1}, ...$都处于稳态值$X_{ss}$。由于方程(10)是倒向的，从$v_T=v_{ss}$往回看，只要未来的输入都是$X_{ss}$，那么价值函数和策略函数就都会是稳态值。因此$y_t^s = y_{ss}$，$\Lambda_t^s = \Lambda_{ss}$。
    *   当$s \geq t$时，冲击还未发生。代理人在$t$时刻的决策，取决于未来$s$时刻的冲击。关键在于，代理人的决策只关心**距离冲击还有多久**（即$s-t$），而不关心当前的日历时间$t$是多少。比如，$t=0$时对$s=1$冲击的反应（距离1期），和$t=50$时对$s=51$冲击的反应（距离1期）是完全一样的。
    *   作者用$y_{T-1-(s-t)}^{T-1}$来表示这个关系。$T-1$是一个基准冲击时刻。$y_{t'}^{T-1}$表示在$t'$时刻对$T-1$时刻冲击的反应。那么距离是$(T-1)-t'$。我们让这个距离等于$s-t$，即$(T-1)-t' = s-t$，解得$t' = T-1-(s-t)$。所以，在$t$时刻对$s$时刻冲击的反应，等价于在$t'=T-1-(s-t)$时刻对$T-1$时刻冲击的反应。

*   **重要启示**: 我们不再需要为每一个$s$都做一次向后迭代。我们**只需要做一次向后迭代**，即计算对$s=T-1$这个最远期冲击的反应，就能得到所有的$y_t^{T-1}$和$\Lambda_t^{T-1}$。然后根据引理1，我们就可以构造出任意$(t,s)$组合下的$y_t^s$和$\Lambda_t^s$了。这极大地减少了计算量。

**引理2**

这个引理是算法的第二个关键。它研究的是总量响应$dY_t^s$的变化规律。

定义一个差分项：$\mathcal{F}_{t,s} \cdot dx \equiv dY_t^s - dY_{t-1}^{s-1}$。
*   **直觉**: 这个$\mathcal{F}_{t,s}$比较的是两个情景下的总量响应：
    1.  $dY_t^s$：在$t$时刻观察到的、对$s$时刻冲击的响应。
    2.  $dY_{t-1}^{s-1}$：在$t-1$时刻观察到的、对$s-1$时刻冲击的响应。
    根据引理1，个体策略函数具有平移不变性，即$dy_t^s = dy_{t-1}^{s-1}$。那么总量的响应是否也具有这种平移不变性呢？引理2回答了这个问题：不完全是，因为分布$D_t$也在演化。

**引理2内容**: 假设$D_0 = D_{ss}$，对于无穷小的$dx$，以及任意$s \geq 1, t \geq 1$，有：
$$ \mathcal{F}_{t,s} \cdot dx = y_{ss}' (\Lambda_{ss}')^{t-1} dD_1^s $$

*   **证明详解**:
    1.  **线性化$Y_t^s$**: $Y_t^s = (y_{ss} + dy_t^s)' (D_{ss} + dD_t^s) = y_{ss}'D_{ss} + y_{ss}'dD_t^s + (dy_t^s)'D_{ss} + (dy_t^s)'dD_t^s$。由于$Y_{ss} = y_{ss}'D_{ss}$，且$(dy_t^s)'dD_t^s$是二阶小量，可以忽略。所以一阶近似下有：
    $$ dY_t^s = y_{ss}' dD_t^s + (dy_t^s)' D_{ss} \quad (19) $$
    2.  **计算$\mathcal{F}_{t,s}$**:
    $$ \mathcal{F}_{t,s} \cdot dx = dY_t^s - dY_{t-1}^{s-1} = (y_{ss}' dD_t^s + (dy_t^s)' D_{ss}) - (y_{ss}' dD_{t-1}^{s-1} + (dy_{t-1}^{s-1})' D_{ss}) $$
    根据引理1，我们知道个体策略的响应是平移不变的，即$dy_t^s = dy_{t-1}^{s-1}$。所以上式中的$(dy_t^s)' D_{ss}$项和$(dy_{t-1}^{s-1})' D_{ss}$项相互抵消。剩下：
    $$ \mathcal{F}_{t,s} \cdot dx = y_{ss}' (dD_t^s - dD_{t-1}^{s-1}) $$
    3.  **线性化$D_{t+1}^s$**: $D_{t+1}^s = (\Lambda_t^s)' D_t^s = (\Lambda_{ss} + d\Lambda_t^s)'(D_{ss} + dD_t^s)$。同样取一阶近似，得到：
    $$ dD_{t+1}^s = \Lambda_{ss}' dD_t^s + (d\Lambda_t^s)' D_{ss} \quad (21) $$
    4.  **研究分布的差分**: 我们需要计算$dD_t^s - dD_{t-1}^{s-1}$。
        *   $dD_t^s = \Lambda_{ss}' dD_{t-1}^s + (d\Lambda_{t-1}^s)' D_{ss}$
        *   $dD_{t-1}^{s-1} = \Lambda_{ss}' dD_{t-2}^{s-1} + (d\Lambda_{t-2}^{s-1})' D_{ss}$
        将两式相减，再次利用引理1的平移不变性（$d\Lambda_{t-1}^s = d\Lambda_{t-2}^{s-1}$），得到：
        $$ dD_t^s - dD_{t-1}^{s-1} = \Lambda_{ss}' (dD_{t-1}^s - dD_{t-2}^{s-1}) $$
        这是一个递归关系！我们可以不断向前迭代：
        $$ dD_t^s - dD_{t-1}^{s-1} = (\Lambda_{ss}')^2 (dD_{t-2}^s - dD_{t-3}^{s-1}) = \dots = (\Lambda_{ss}')^{t-1} (dD_1^s - dD_0^{s-1}) $$
    5.  **利用初始条件**: 初始分布是稳态分布，$D_0 = D_{ss}$。这意味着对于任何冲击（无论发生在何时），$t=0$的分布都是$D_{ss}$。所以$D_0^{s-1} = D_{ss}$，因此$dD_0^{s-1} = D_0^{s-1} - D_{ss} = 0$。
    所以递归的最终结果是：
    $$ dD_t^s - dD_{t-1}^{s-1} = (\Lambda_{ss}')^{t-1} dD_1^s $$
    6.  **整合结果**: 将第5步的结果代入第2步，就得到了引理2的结论：
    $$ \mathcal{F}_{t,s} \cdot dx = y_{ss}' (\Lambda_{ss}')^{t-1} dD_1^s $$

*   **“假新闻”的直觉解释**:
    *   $\mathcal{F}_{t,s}$代表了什么？它代表了对一个“在0时刻宣布、将在$s$时刻发生、但在1时刻又被撤回”的冲击的响应。
    *   在$t=0$时刻，代理人听到了新闻（$s$时刻有冲击），于是他们改变了自己的行为，这导致了$t=1$时刻的分布从$D_{ss}$变成了$D_1^s$。所以产生了$dD_1^s$。
    *   在$t=1$时刻，新闻被证实是“假的”（冲击被撤回），从这一刻起，所有未来的输入$X_1, X_2, ...$都回到了稳态$X_{ss}$。于是代理人也恢复了他们的稳态决策规则。
    *   那么从$t=1$开始，经济唯一的不同之处就在于初始分布是$D_1^s$而不是$D_{ss}$。这个被扰动了的分布$dD_1^s$会在稳态转移矩阵$\Lambda_{ss}'$的作用下随时间演化，对未来每一期的总量输出产生影响。
    *   在$t$时刻，这个影响就是$y_{ss}' (\Lambda_{ss}')^{t-1} dD_1^s$。这正好就是引理2的公式。

**定义1: 期望向量**
为了简化表达，定义期望向量（Expectation Vector）:
$$\mathcal{E}_t \equiv (\Lambda_{ss})^t y_{ss} \quad (23)$$

*   **直觉**: $\mathcal{E}_t$的第$i$个元素，代表一个从网格点$i$出发的代理人，在稳态环境下，$t$期之后其个体结果$y$的期望值。
*   利用这个定义，引理2的结论可以优美地写作：$\mathcal{F}_{t,s} \cdot dx = \mathcal{E}_{t-1}' dD_1^s$。

**命题1**

这是算法的核心定理，它将雅可比矩阵$J$和我们刚刚定义的“假新闻”矩阵$\mathcal{F}$联系起来。

*   **定义假新闻矩阵$\mathcal{F}$**: 其$(t,s)$元素为
$$
\mathcal{F}_{t,s} \cdot dx \equiv \begin{cases} 
dY_0^s & t = 0 \\
\mathcal{E}_{t-1}' dD_1^s & t \geq 1 
\end{cases}
$$
其中$dY_0^s = (dy_0^s)' D_{ss}$，且$dD_1^s = (d\Lambda_0^s)' D_{ss}$。

*   **命题**: $J$满足递归关系$J_{t,s} = J_{t-1,s-1} + \mathcal{F}_{t,s}$（对于$t,s \geq 1$），并且边界条件由$\mathcal{F}$给出。最终，$J$的元素由下式给出：
$$ \mathcal{J}_{t,s} = \sum_{k=0}^{\min\{s,t\}} \mathcal{F}_{t-k,s-k} $$

*   **证明详解**:
    *   对于$t, s \geq 1$，根据$\mathcal{F}_{t,s}$的定义，我们有$\mathcal{F}_{t,s} \cdot dx = dY_t^s - dY_{t-1}^{s-1}$。两边同时除以$dx$并取极限，就得到$J_{t,s} = J_{t-1,s-1} + \mathcal{F}_{t,s}$。
    *   这个递归关系展开，就是$J_{t,s} = \mathcal{F}_{t,s} + J_{t-1,s-1} = \mathcal{F}_{t,s} + \mathcal{F}_{t-1,s-1} + J_{t-2,s-2} = \dots$，最终得到求和公式。这说明$J$的$(t,s)$元素是$\mathcal{F}$矩阵中从$(t,s)$位置开始沿左上对角线方向所有元素的和。
    *   **边界条件**:
        *   当$t=0$时，根据定义$J_{0,s} \cdot dx = dY_0^s$，这正好等于$\mathcal{F}_{0,s} \cdot dx$。
        *   当$s=0$时，冲击发生在第0期。对于$t \geq 1$，引理1意味着$y_t^0 = y_{ss}$，所以$dy_t^0=0$。根据线性化公式(19)，$dY_t^0 = y_{ss}' dD_t^0$。因为冲击只在$s=0$发生，所以对所有$t \geq 1$，$\Lambda_{t-1}^0 = \Lambda_{ss}$，因此$d\Lambda_{t-1}^0=0$。根据线性化公式(21)，$dD_t^0 = \Lambda_{ss}' dD_{t-1}^0$。递归下去得到$dD_t^0 = (\Lambda_{ss}')^{t-1} dD_1^0$。所以$J_{t,0} \cdot dx = dY_t^0 = y_{ss}' (\Lambda_{ss}')^{t-1} dD_1^0 = \mathcal{E}_{t-1}' dD_1^0$。这也正好等于$\mathcal{F}_{t,0} \cdot dx$。
    *   证明完毕。这个命题的意义在于，我们只要能计算出相对简单的$\mathcal{F}$矩阵，就能通过简单的累加得到复杂的$J$矩阵。

**引理3**
这个引理给出了计算期望向量$\mathcal{E}_t$的简便方法。
$$\mathcal{E}_t = \Lambda_{ss} \mathcal{E}_{t-1}$$，初始条件为$\mathcal{E}_0 = y_{ss}$。

*   **证明**: 这直接来自$\mathcal{E}_t$的定义：$\mathcal{E}_t = (\Lambda_{ss})^t y_{ss} = \Lambda_{ss} (\Lambda_{ss})^{t-1} y_{ss} = \Lambda_{ss} \mathcal{E}_{t-1}$。

**假新闻算法步骤总结（单输入输出情况）**

现在，我们可以将所有部分组合成一个清晰的四步算法。

1.  **第一步：计算核心冲击响应**
    *   进行**一次**向后迭代，计算模型对$s=T-1$时刻冲击的反应。根据引理1，这足以让我们得到**所有**$s=0, ..., T-1$的$dy_0^s$和$d\Lambda_0^s$。
    *   利用这些结果，计算两个“原始对象”：
        *   一个$T \times 1$的向量$\mathcal{Y}$，其元素为$\mathcal{Y}_s = (dy_0^s)' D_{ss} / dx$。这代表了$s$时刻的冲击对**第0期**输出的影响。
        *   $T$个$n_g \times 1$的向量$\mathcal{D}_s$，定义为$\mathcal{D}_s = (d\Lambda_0^s)' D_{ss} / dx$。这代表了$s$时刻的冲击对**第1期**分布的影响。

2.  **第二步：计算期望向量**
    *   利用引理3的递归关系$\mathcal{E}_t = \Lambda_{ss} \mathcal{E}_{t-1}$，从$\mathcal{E}_0 = y_{ss}$开始，迭代计算出所有的期望向量$\mathcal{E}_1, \mathcal{E}_2, ..., \mathcal{E}_{T-2}$。

3.  **第三步：构建假新闻矩阵$\mathcal{F}$**
    *   根据命题1的定义，构建$\mathcal{F}$矩阵。
    *   $\mathcal{F}$的第一行 ($t=0$) 就是第一步中计算的向量$\mathcal{Y}$。
    *   $\mathcal{F}$的其他行 ($t \geq 1$) 的元素$(t,s)$由$\mathcal{E}_{t-1}' \mathcal{D}_s$给出。
    
    $$
    \mathcal{F} = \begin{bmatrix} 
    \mathcal{Y}_0 & \mathcal{Y}_1 & \cdots & \mathcal{Y}_{T-1} \\
    \mathcal{E}_0' \mathcal{D}_0 & \mathcal{E}_0' \mathcal{D}_1 & & \mathcal{E}_0' \mathcal{D}_{T-1} \\
    \mathcal{E}_1' \mathcal{D}_0 & \mathcal{E}_1' \mathcal{D}_1 & & \mathcal{E}_1' \mathcal{D}_{T-1} \\
    \vdots & \vdots & & \vdots \\
    \mathcal{E}_{T-2}' \mathcal{D}_0 & \mathcal{E}_{T-2}' \mathcal{D}_1 & \cdots & \mathcal{E}_{T-2}' \mathcal{D}_{T-1} 
    \end{bmatrix}
    $$
    
4.  **第四步：通过累加构建雅可比矩阵$J$**
    *   利用命题1的求和公式$J_{t,s} = \sum_{k=0}^{\min\{s,t\}} \mathcal{F}_{t-k,s-k}$来计算$J$。
    *   这相当于$J$的$(t,s)$元素是$\mathcal{F}$矩阵中，从$(t,s)$元素开始，沿其左上对角线一直到矩阵边界的所有元素的和。例如，$J_{2,2} = \mathcal{F}_{2,2} + \mathcal{F}_{1,1} + \mathcal{F}_{0,0}$。根据$\mathcal{F}$的定义，这等于$\mathcal{E}_1' \mathcal{D}_2 + \mathcal{E}_0' \mathcal{D}_1 + \mathcal{Y}_0$ (注意论文原文中的$\mathcal{Y}_0$应为$\mathcal{F}_{0,0}$，而$\mathcal{F}_{0,s}=\mathcal{Y}_s$) (注：原文的例子是正确的，因为$J_{2,2}$是$\mathcal{F}$矩阵中沿$(2,2), (1,1), (0,0)$对角线的和，对应的值是$\mathcal{E}_1'\mathcal{D}_2$, $\mathcal{E}_0'\mathcal{D}_1$ 和 $\mathcal{F}_{0,0}=\mathcal{Y}_0$)。

**算法优势**: 该算法的计算速度远超直接法。直接法需要$T$次向后和$T$次向前迭代。而假新闻算法只需要**一次**向后迭代（计算$\mathcal{Y}$和$\mathcal{D}$），一次简单的正向迭代（计算$\mathcal{E}$），然后是一些矩阵乘法和累加。计算成本从$O(T^2)$级别下降到了$O(T)$级别。

**示例：克鲁塞尔-史mith模型（图2解读）**
*   **(a) 面板 (J的列)**: 展示了雅可比矩阵$J^{K,r}$的几列，即总资本$K$对不同时期$s$的利率$r$冲击的脉冲响应。
    *   **$s=0$冲击**: 利率突然上升，持有资产的人财富增加，产生财富效应，他们会增加储蓄，导致资本先上升后下降。
    *   **$s>0$冲击**: 代理人**预期**到未来利率会上升，根据跨期替代效应，他们会提前开始储蓄以利用未来的高回报，导致资本在冲击发生前就开始上升，形成一个“帐篷”形状。
*   **(b) 和 (c) 面板 (F的列)**: 展示了假新闻矩阵$\mathcal{F}$的列。
    *   $J$的第一列就是$\mathcal{F}$的第一列。
    *   $J$的其他列是$\mathcal{F}$对应列和其左上方各列的累加。$\mathcal{F}$的列可以解释为对“假新闻”的响应：在0期听说$s$期利率要涨（于是开始储蓄），但在1期发现是假新闻（于是停止为之储蓄，并开始消费掉之前额外储蓄的财富）。
*   **收敛模式**: 对于远期的冲击（比如$s=50, 75, 100$），脉冲响应的形状几乎一样，只是在时间轴上平移了。这是因为$\mathcal{F}_{t,s}$项（即初始分布扰动的影响）会随着时间$t$的推移而衰减至零。当$t, s$都很大时，$\mathcal{F}_{t,s} \approx 0$，因此$J_{t,s} \approx J_{t-1,s-1}$，这表现为脉冲响应曲线的平移不变性。

**多输入和多输出的推广**
该算法可以轻松推广到多个输入和输出的情况。

*   可以对每一对输入$i$和输出$o$分别运行一次算法。
*   但为了更高效，可以发现有些计算可以共享：
    *   $\mathcal{D}_s^i$: 只依赖于输入$i$。对每个输入$i$计算一次即可。
    *   $\mathcal{E}_t^o$: 只依赖于输出$o$。对每个输出$o$计算一次即可。
    *   $\mathcal{Y}_s^{o,i}$: 同时依赖于输入$i$和输出$o$。这需要在对每个输入$i$进行向后迭代时，同时计算其对所有输出$o$的初始影响。
*   然后，对每一对$(o,i)$，可以构建一个$\mathcal{F}^{o,i}$矩阵，其第一行是$\mathcal{Y}_s^{o,i}$，其他元素是$(\mathcal{E}_{t-1}^o)' \mathcal{D}_s^i$。最后通过累加得到对应的雅可比矩阵块$J^{o,i}$。

**实现与准确性**
作者建议使用简单的**单侧数值微分**（one-sided numerical differentiation）来实现，即用$(f(x+h)-f(x))/h$来近似导数。这种方法简单易行，但会引入微小的误差。附录中提到了更精确的方法，如**双侧数值微分**（centered difference）或可以完全消除这类误差的**自动微分**（automatic differentiation）。